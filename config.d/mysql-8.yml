images:
  mysql-8:
    image: mysql:8.0
    shell: /bin/bash
    keep_alive_cmd: mysqld
    description: "MySQL 8.0 (Latest)"
    category: database
    
    environment:
      MYSQL_ROOT_PASSWORD: playground
      MYSQL_DATABASE: playground
      MYSQL_USER: playground
      MYSQL_PASSWORD: playground
    
    ports:
      - "3306:3306"
    
    motd: |
      â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
      â•‘                    MySQL 8.0 Quick Reference                  â•‘
      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      ðŸ” Connection Info:
         Host: localhost / Container IP
         Port: 3306
         Root User: root
         Root Password: playground
         User: playground
         Password: playground
         Database: playground
      
      ðŸ“Š Basic Commands:
         mysql -u root -pplayground                    # Connect as root
         mysql -u playground -pplayground playground   # Connect to playground DB
      
      ðŸ“ Database Operations:
         SHOW DATABASES;                               # List all databases
         CREATE DATABASE mydb;                         # Create database
         USE mydb;                                     # Switch to database
         DROP DATABASE mydb;                           # Delete database
         SHOW TABLES;                                  # List tables
         DESCRIBE tablename;                           # Show table structure
      
      ðŸ’¾ Backup & Restore:
         # Backup single database
         mysqldump -u root -pplayground playground > /shared/backup.sql
         
         # Backup all databases
         mysqldump -u root -pplayground --all-databases > /shared/full_backup.sql
         
         # Backup specific table
         mysqldump -u root -pplayground playground users > /shared/users_backup.sql
         
         # Restore database
         mysql -u root -pplayground playground < /shared/backup.sql
         
         # Restore with creation
         mysql -u root -pplayground < /shared/backup.sql
      
      ðŸ“ Quick Table Example:
         CREATE TABLE users (
           id INT AUTO_INCREMENT PRIMARY KEY,
           name VARCHAR(100),
           email VARCHAR(100) UNIQUE,
           created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
         );
         
         INSERT INTO users (name, email) VALUES 
           ('Alice', 'alice@example.com'),
           ('Bob', 'bob@example.com');
         
         SELECT * FROM users;
      
      ðŸ” Useful Queries:
         SELECT USER(), DATABASE();                    # Current user & DB
         SHOW PROCESSLIST;                            # Active connections
         SHOW VARIABLES LIKE '%version%';             # MySQL version info
         SHOW TABLE STATUS;                           # Table information
         SHOW FULL PROCESSLIST;                       # Detailed process list
      
      ðŸ”§ User Management:
         CREATE USER 'newuser'@'%' IDENTIFIED BY 'password';
         GRANT ALL PRIVILEGES ON database.* TO 'newuser'@'%';
         FLUSH PRIVILEGES;
         SHOW GRANTS FOR 'username'@'%';
      
      ðŸ’¡ Tips:
         - Use /shared for SQL dumps
         - root password: playground
         - Default character set: utf8mb4
    
    scripts:
      post_start:
        inline: |
          #!/bin/bash
          CONTAINER_NAME="$1"
          echo "ðŸ¬ Initializing MySQL 8.0 for $CONTAINER_NAME..."
          
          # Wait for MySQL to be ready
          sleep 10
          
          # Create example table
          docker exec "playground-$CONTAINER_NAME" mysql -u playground -pplayground playground -e "
          CREATE TABLE IF NOT EXISTS playground_info (
              id INT AUTO_INCREMENT PRIMARY KEY,
              created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
              message TEXT,
              version VARCHAR(50)
          );
          
          INSERT INTO playground_info (message, version) 
          VALUES ('MySQL initialized by playground manager', '8.0');
          " 2>/dev/null
          
          echo "âœ“ MySQL 8.0 initialized with test table"
      
      pre_stop:
        inline: |
          #!/bin/bash
          CONTAINER_NAME="$1"
          echo "ðŸ’¾ Backing up MySQL databases from $CONTAINER_NAME..."
          
          BACKUP_DIR="${SHARED_DIR:-./shared-volumes}/backups/mysql-8"
          mkdir -p "$BACKUP_DIR"
          
          TIMESTAMP=$(date +%Y%m%d_%H%M%S)
          
          # Backup playground database
          BACKUP_FILE="$BACKUP_DIR/mysql_playground_${TIMESTAMP}.sql"
          docker exec "playground-$CONTAINER_NAME" \
            mysqldump -u root -pplayground playground > "$BACKUP_FILE" 2>/dev/null
          
          if [ -f "$BACKUP_FILE" ] && [ -s "$BACKUP_FILE" ]; then
            echo "âœ“ Database backup saved to: backups/mysql-8/mysql_playground_${TIMESTAMP}.sql"
          else
            rm -f "$BACKUP_FILE"
            echo "âš  Database backup failed"
          fi
          
          # Backup list of all databases
          docker exec "playground-$CONTAINER_NAME" \
            mysql -u root -pplayground -e "SHOW DATABASES;" > \
            "$BACKUP_DIR/databases_${TIMESTAMP}.txt" 2>/dev/null || true
          
          echo "âœ“ Backup completed"