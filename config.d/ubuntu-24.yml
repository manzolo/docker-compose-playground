images:
  ubuntu-24:
    image: ubuntu:24.04
    shell: /bin/bash
    keep_alive_cmd: sleep infinity
    description: Ubuntu 24.04 LTS (Noble Numbat) - Latest LTS
    category: linux
    motd: |-
      ╔══════════════════════════════════════════════════════════════╗
      ║                Ubuntu 24.04 Quick Reference                  ║
      ╚══════════════════════════════════════════════════════════════╝

      📦 Package Management:
         apt update                                # Update package list
         apt upgrade                               # Upgrade packages
         apt install package_name                  # Install package
         apt search package_name                   # Search package

      🔧 System Info:
         lsb_release -a                            # Ubuntu version
         uname -a                                  # Kernel info
         df -h                                     # Disk usage
         free -h                                   # Memory usage

      📁 Useful Directories:
         /shared                                   # Shared with host
         /etc/apt/sources.list                     # Package sources

      🚀 Quick Setup:
         apt update && apt install -y vim curl git wget build-essential
    scripts:
      post_start:
        inline: |-
          #!/bin/bash
          CONTAINER_NAME="$1"
          echo "🐧 Initializing Ubuntu 24.04 for $CONTAINER_NAME..."

          # Install packages silently in background to avoid blocking
          docker exec "$CONTAINER_NAME" bash -c '
          export DEBIAN_FRONTEND=noninteractive
          (
            apt-get update -qq >/dev/null 2>&1 && \
            apt-get install -y -qq \
              vim curl wget git build-essential \
              net-tools iputils-ping dnsutils \
              htop tree less >/dev/null 2>&1
          ) &
          ' 2>/dev/null

          echo "✓ Ubuntu 24.04 initialization started in background"
      pre_stop:
        inline: |-
          #!/bin/bash
          CONTAINER_NAME="$1"
          echo "💾 Backing up Ubuntu configuration for $CONTAINER_NAME..."

          # Create backup directory
          BACKUP_DIR="${SHARED_DIR:-./shared-volumes}/backups/ubuntu-24"
          mkdir -p "$BACKUP_DIR"

          TIMESTAMP=$(date +%Y%m%d_%H%M%S)

          # Backup installed packages list
          docker exec "$CONTAINER_NAME" dpkg --get-selections > \
            "$BACKUP_DIR/packages_${TIMESTAMP}.txt" 2>/dev/null || true

          # Backup apt sources
          docker exec "$CONTAINER_NAME" cat /etc/apt/sources.list > \
            "$BACKUP_DIR/sources_${TIMESTAMP}.txt" 2>/dev/null || true

          echo "✓ Backup saved to: backups/ubuntu-24/"
